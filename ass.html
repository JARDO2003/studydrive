
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyDrive - Plateforme Acad√©mique Professionnelle</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-light: #60a5fa;
            --primary-dark: #1e40af;
            --accent: #f59e0b;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --dark-lighter: #334155;
            --white: #ffffff;
            --gray: #94a3b8;
            --gray-light: #f1f5f9;
            --success: #10b981;
            --shadow: rgba(37, 99, 235, 0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--gray-light);
            color: var(--dark);
            overflow-x: hidden;
        }

        /* INTRO SECTION */
        #introSection {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 10000;
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .intro-background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 50%, rgba(96, 165, 250, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 50%, rgba(37, 99, 235, 0.1) 0%, transparent 50%);
        }

        .intro-content {
            text-align: center;
            z-index: 2;
            animation: fadeInUp 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .intro-logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 30px;
            background: var(--white);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .intro-title {
            font-size: 56px;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 15px;
            letter-spacing: -2px;
        }

        .intro-subtitle {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
            margin-bottom: 50px;
        }

        .intro-progress {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 auto;
            border-radius: 10px;
            overflow: hidden;
        }

        .intro-progress-bar {
            height: 100%;
            background: var(--white);
            width: 0%;
            animation: loading 2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        @keyframes loading {
            to { width: 100%; }
        }

        /* REGISTRATION */
        #registrationOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: var(--gray-light);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9000;
            padding: 20px;
        }

        .registration-box {
            background: var(--white);
            padding: 50px;
            border-radius: 16px;
            max-width: 480px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        }

        .registration-logo {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            margin: 0 auto 25px;
        }

        .registration-title {
            font-size: 32px;
            font-weight: 800;
            color: var(--dark);
            text-align: center;
            margin-bottom: 10px;
        }

        .registration-subtitle {
            text-align: center;
            color: var(--gray);
            margin-bottom: 35px;
            font-size: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            background: var(--gray-light);
            border: 2px solid transparent;
            color: var(--dark);
            font-size: 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--white);
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--shadow);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* MAIN APP */
        #mainApp {
            display: none;
            min-height: 100vh;
            background: var(--gray-light);
        }

        /* NAVBAR */
        .navbar {
            background: var(--white);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }

        .logo-text h1 {
            font-size: 22px;
            font-weight: 800;
            color: var(--dark);
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 12px;
            color: var(--gray);
            font-weight: 500;
        }

        .navbar-menu {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .nav-link {
            color: var(--gray);
            text-decoration: none;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--gray-light);
            padding: 8px 16px;
            border-radius: 12px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .user-info h3 {
            font-size: 14px;
            font-weight: 700;
            color: var(--dark);
        }

        .user-info p {
            font-size: 12px;
            color: var(--gray);
            font-weight: 500;
        }

        /* SEARCH BAR */
        .search-section {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 30px;
        }

        .search-container {
            position: relative;
            max-width: 700px;
            margin: 0 auto;
        }

        .search-box {
            background: var(--white);
            border: 2px solid transparent;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .search-box:focus-within {
            border-color: var(--primary);
            box-shadow: 0 4px 20px var(--shadow);
        }

        .search-icon {
            font-size: 20px;
        }

        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--dark);
            font-size: 15px;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            outline: none;
        }

        .search-input::placeholder {
            color: var(--gray);
            font-weight: 400;
        }

        .search-clear {
            background: var(--gray-light);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: var(--gray);
            transition: all 0.3s ease;
        }

        .search-clear:hover {
            background: var(--primary);
            color: var(--white);
        }

        .search-clear.active {
            display: flex;
        }

        /* SEARCH SUGGESTIONS */
        .search-suggestions {
            position: absolute;
            top: calc(100% + 10px);
            left: 0;
            right: 0;
            background: var(--white);
            border-radius: 12px;
            max-height: 500px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .search-suggestions.active {
            display: block;
        }

        .suggestions-header {
            padding: 18px 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .suggestions-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--dark);
        }

        .suggestions-count {
            font-size: 12px;
            color: var(--gray);
            font-weight: 600;
        }

        .suggestion-item {
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .suggestion-item:hover {
            background: var(--gray-light);
        }

        .suggestion-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            object-fit: cover;
        }

        .suggestion-info {
            flex: 1;
        }

        .suggestion-title {
            font-weight: 600;
            font-size: 14px;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .suggestion-highlight {
            background: rgba(37, 99, 235, 0.15);
            color: var(--primary);
            padding: 0 2px;
        }

        .suggestion-meta {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: var(--gray);
            font-weight: 500;
        }

        .suggestion-badge {
            display: inline-block;
            padding: 3px 8px;
            font-size: 10px;
            font-weight: 700;
            border-radius: 5px;
        }

        .no-results {
            padding: 50px 20px;
            text-align: center;
        }

        .no-results-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.3;
        }

        .no-results-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .no-results-hint {
            font-size: 13px;
            color: var(--gray);
        }

        .search-shortcuts {
            padding: 15px 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .shortcut-chip {
            padding: 6px 12px;
            background: var(--gray-light);
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shortcut-chip:hover {
            background: var(--primary);
            color: var(--white);
        }

        /* CONTROLS */
        .controls-section {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .section-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--dark);
        }

        .filter-btn {
            padding: 10px 20px;
            background: var(--white);
            border: 2px solid transparent;
            border-radius: 10px;
            color: var(--gray);
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--white);
        }

        .publish-btn {
            padding: 12px 28px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .publish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px var(--shadow);
        }

        /* SUBJECTS GRID */
        .subjects-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 30px 60px;
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .subject-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s ease;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .subject-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
        }

        .subject-image {
            width: 100%;
            height: 220px;
            object-fit: cover;
            transition: all 0.4s ease;
        }

        .subject-card:hover .subject-image {
            transform: scale(1.05);
        }

        .subject-content {
            padding: 25px;
        }

        .subject-header {
            margin-bottom: 15px;
        }

        .subject-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .subject-badge {
            display: inline-block;
            padding: 5px 12px;
            font-size: 11px;
            font-weight: 700;
            border-radius: 6px;
        }

        .badge-iter { 
            color: #6366f1; 
            background: rgba(99, 102, 241, 0.1);
        }
        .badge-gcv { 
            color: #10b981; 
            background: rgba(16, 185, 129, 0.1);
        }
        .badge-seg { 
            color: #f59e0b; 
            background: rgba(245, 158, 11, 0.1);
        }
        .badge-icrh { 
            color: #ec4899; 
            background: rgba(236, 72, 153, 0.1);
        }

        .subject-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 12px;
            color: var(--gray);
            font-size: 13px;
            font-weight: 600;
        }

        .subject-divider {
            width: 100%;
            height: 1px;
            background: var(--gray-light);
            margin: 18px 0;
        }

        .subject-author {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .author-avatar {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
        }

        .author-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--dark);
        }

        .author-time {
            font-size: 12px;
            color: var(--gray);
            font-weight: 500;
        }

        /* IMAGE FULLSCREEN MODAL */
        .image-fullscreen-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .fullscreen-content {
            position: relative;
            max-width: 95%;
            max-height: 95vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .fullscreen-image {
            max-width: 100%;
            max-height: 85vh;
            object-fit: contain;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .fullscreen-controls {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .fullscreen-btn {
            padding: 12px 24px;
            background: var(--white);
            color: var(--dark);
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .fullscreen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.2);
        }

        .fullscreen-close {
            position: absolute;
            top: -50px;
            right: 0;
            background: var(--white);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            color: var(--dark);
            transition: all 0.3s ease;
        }

        .fullscreen-close:hover {
            background: var(--primary);
            color: var(--white);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 5000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--white);
            padding: 40px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-header h2 {
            font-size: 28px;
            font-weight: 800;
            color: var(--dark);
        }

        .close-btn {
            background: var(--gray-light);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 22px;
            color: var(--gray);
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--primary);
            color: var(--white);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: block;
            width: 100%;
        }

        .file-input-btn {
            background: var(--gray-light);
            border: 2px dashed var(--gray);
            border-radius: 12px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-input-btn:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: -9999px;
        }

        .image-preview {
            margin-top: 20px;
            border-radius: 12px;
            overflow: hidden;
        }

        .image-preview img {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 80px;
            color: var(--gray);
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--gray-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .navbar-content {
                flex-direction: column;
                gap: 15px;
            }

            .navbar-menu {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .user-badge {
                width: 100%;
                justify-content: center;
            }

            .controls-section {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                flex-wrap: wrap;
            }

            .filter-btn {
                flex: 1;
                min-width: calc(50% - 5px);
            }

            .publish-btn {
                width: 100%;
            }

            .subjects-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                padding: 30px 20px;
            }

            .registration-box {
                padding: 40px 25px;
            }

            .intro-title {
                font-size: 42px;
            }
        }

        @media (hover: none) and (pointer: coarse) {
            .subject-card:active {
                transform: translateY(-5px);
            }
        }
    </style>
</head>
<body>
    <!-- INTRO SECTION -->
    <div id="introSection">
        <div class="intro-background"></div>
        <div class="intro-content">
            <div class="intro-logo">üéì</div>
            <h1 class="intro-title">StudyDrive</h1>
            <p class="intro-subtitle">Plateforme Acad√©mique Professionnelle</p>
            <div class="intro-progress">
                <div class="intro-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- REGISTRATION -->
    <div id="registrationOverlay">
        <div class="registration-box">
            <div class="registration-logo">üéì</div>
            <h2 class="registration-title">Bienvenue</h2>
            <p class="registration-subtitle">Cr√©ez votre compte pour commencer</p>
            <form id="registrationForm">
                <div class="form-group">
                    <label for="nom">Nom</label>
                    <input type="text" id="nom" required placeholder="Votre nom">
                </div>
                <div class="form-group">
                    <label for="prenom">Pr√©nom</label>
                    <input type="text" id="prenom" required placeholder="Votre pr√©nom">
                </div>
                <div class="form-group">
                    <label for="filiere">Fili√®re</label>
                    <select id="filiere" required>
                        <option value="">S√©lectionnez votre fili√®re</option>
                        <option value="ITER">ITER</option>
                        <option value="GCV">GCV</option>
                        <option value="SEG">SEG</option>
                        <option value="ICRH">ICRH</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contact">Contact</label>
                    <input type="text" id="contact" required placeholder="email@exemple.com">
                </div>
                <button type="submit" class="submit-btn">Commencer</button>
            </form>
        </div>
    </div>
    
    <!-- MAIN APP -->
    <div id="mainApp">
        <!-- NAVBAR -->
        <nav class="navbar">
            <div class="navbar-content">
                <div class="logo-container">
                    <div class="logo-icon">üéì</div>
                    <div class="logo-text">
                        <h1>StudyDrive</h1>
                        <p>Excellence</p>
                    </div>
                </div>
                <div class="navbar-menu">
                    <a href="#" class="nav-link">Accueil</a>
                    <a href="apropos.html" class="nav-link">√Ä Propos</a>
                    <a href="#" class="nav-link">Ressources</a>
                    <div class="user-badge">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div class="user-info">
                            <h3 id="userName">Utilisateur</h3>
                            <p id="userFiliere">Fili√®re</p>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- SEARCH BAR -->
        <div class="search-section">
            <div class="search-container">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput"
                        placeholder="Rechercher un sujet, une mati√®re, une ann√©e..."
                        autocomplete="off"
                    >
                    <button class="search-clear" id="searchClear" onclick="clearSearch()">√ó</button>
                </div>
                
                <div class="search-suggestions" id="searchSuggestions">
                    <div class="suggestions-header">
                        <span class="suggestions-title">R√©sultats</span>
                        <span class="suggestions-count" id="suggestionsCount">0 trouv√©(s)</span>
                    </div>
                    <div id="suggestionsList"></div>
                    <div class="search-shortcuts">
                        <span style="font-size: 11px; color: var(--gray); font-weight: 600;">RECHERCHES RAPIDES:</span>
                        <button class="shortcut-chip" onclick="quickSearch('2024')">2024</button>
                        <button class="shortcut-chip" onclick="quickSearch('2023')">2023</button>
                        <button class="shortcut-chip" onclick="quickSearch('ITER')">ITER</button>
                        <button class="shortcut-chip" onclick="quickSearch('GCV')">GCV</button>
                        <button class="shortcut-chip" onclick="quickSearch('SEG')">SEG</button>
                        <button class="shortcut-chip" onclick="quickSearch('ICRH')">ICRH</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTROLS -->
        <div class="controls-section">
            <div style="display: flex; align-items: center; gap: 30px; flex-wrap: wrap;">
                <h2 class="section-title">Collection</h2>
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all">Tous</button>
                    <button class="filter-btn" data-filter="ITER">ITER</button>
                    <button class="filter-btn" data-filter="GCV">GCV</button>
                    <button class="filter-btn" data-filter="SEG">SEG</button>
                    <button class="filter-btn" data-filter="ICRH">ICRH</button>
                </div>
            </div>
            <button class="publish-btn" onclick="openPublishModal()">+ Publier</button>
        </div>

        <!-- SUBJECTS -->
        <div class="subjects-container">
            <div class="subjects-grid" id="subjectsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Chargement...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- PUBLISH MODAL -->
    <div id="publishModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nouveau Sujet</h2>
                <button class="close-btn" onclick="closePublishModal()">√ó</button>
            </div>
            <form id="publishForm">
                <div class="form-group">
                    <label for="subjectTitle">Titre</label>
                    <input type="text" id="subjectTitle" required placeholder="Titre du sujet">
                </div>
                <div class="form-group">
                    <label for="subjectFiliere">Fili√®re</label>
                    <select id="subjectFiliere" required>
                        <option value="">S√©lectionnez</option>
                        <option value="ITER">ITER</option>
                        <option value="GCV">GCV</option>
                        <option value="SEG">SEG</option>
                        <option value="ICRH">ICRH</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="subjectYear">Ann√©e</label>
                    <select id="subjectYear" required>
                        <option value="">S√©lectionnez</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Image</label>
                    <div class="file-input-wrapper">
                        <label for="subjectImage" class="file-input-btn">
                            <div style="font-size: 50px; margin-bottom: 15px;">üì∏</div>
                            <div style="font-weight: 700; color: var(--gold); letter-spacing: 2px;">S√âLECTIONNER</div>
                            <div style="font-size: 11px; color: var(--gray); margin-top: 10px; text-transform: uppercase; letter-spacing: 1px;">PNG, JPG jusqu'√† 10MB</div>
                        </label>
                        <input type="file" id="subjectImage" accept="image/*" required>
                    </div>
                    <div id="imagePreview" class="image-preview"></div>
                </div>
                <div class="form-group">
                    <label for="subjectDescription">Description</label>
                    <textarea id="subjectDescription" placeholder="D√©tails optionnels..." style="min-height: 120px; resize: vertical;"></textarea>
                </div>
                <button type="submit" class="submit-btn">Publier</button>
            </form>
        </div>
    </div>

    <!-- IMAGE FULLSCREEN MODAL -->
    <div id="imageFullscreenModal" class="image-fullscreen-modal">
        <div class="fullscreen-content">
            <button class="fullscreen-close" onclick="closeImageFullscreen()">√ó</button>
            <img id="fullscreenImage" class="fullscreen-image" src="" alt="Image en plein √©cran">
            <div class="fullscreen-controls">
                <button class="fullscreen-btn" onclick="downloadImage()">
                    <span>üì•</span> T√©l√©charger HD
                </button>
                <button class="fullscreen-btn" onclick="closeImageFullscreen()">
                    <span>‚úï</span> Fermer
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            doc, 
            setDoc, 
            addDoc, 
            getDocs, 
            query, 
            orderBy, 
            serverTimestamp,
            onSnapshot
        } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyCPGgtXoDUycykLaTSee0S0yY0tkeJpqKI",
            authDomain: "data-com-a94a8.firebaseapp.com",
            databaseURL: "https://data-com-a94a8-default-rtdb.firebaseio.com",
            projectId: "data-com-a94a8",
            storageBucket: "data-com-a94a8.appspot.com",
            messagingSenderId: "276904640935",
            appId: "1:276904640935:web:9cd805aeba6c34c767f682"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const cloudinaryConfig = {
            cloudName: 'djxcqczh1',
            uploadPreset: 'database'
        };

        let userData = null;
        let subjects = [];
        let currentFilter = 'all';
        let currentImageUrl = '';
        let searchTimeout = null;

        // SEARCH FUNCTIONS
        window.clearSearch = function() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchClear').classList.remove('active');
            document.getElementById('searchSuggestions').classList.remove('active');
            renderSubjects();
        };

        window.quickSearch = function(term) {
            document.getElementById('searchInput').value = term;
            performSearch(term);
        };

        function performSearch(query) {
            const searchTerm = query.toLowerCase().trim();
            
            if (searchTerm === '') {
                document.getElementById('searchSuggestions').classList.remove('active');
                document.getElementById('searchClear').classList.remove('active');
                renderSubjects();
                return;
            }

            document.getElementById('searchClear').classList.add('active');

            // Filter subjects based on search
            const filteredResults = subjects.filter(subject => {
                return subject.title.toLowerCase().includes(searchTerm) ||
                       subject.filiere.toLowerCase().includes(searchTerm) ||
                       subject.year.toString().includes(searchTerm) ||
                       (subject.description && subject.description.toLowerCase().includes(searchTerm)) ||
                       subject.authorName.toLowerCase().includes(searchTerm);
            });

            displaySuggestions(filteredResults, searchTerm);
        }

        function displaySuggestions(results, searchTerm) {
            const suggestionsList = document.getElementById('suggestionsList');
            const suggestionsCount = document.getElementById('suggestionsCount');
            const suggestionsContainer = document.getElementById('searchSuggestions');

            suggestionsCount.textContent = `${results.length} trouv√©(s)`;
            suggestionsContainer.classList.add('active');

            if (results.length === 0) {
                suggestionsList.innerHTML = `
                    <div class="no-results">
                        <div class="no-results-icon">üîç</div>
                        <div class="no-results-text">Aucun r√©sultat trouv√©</div>
                        <div class="no-results-hint">Essayez avec d'autres mots-cl√©s</div>
                    </div>
                `;
                return;
            }

            suggestionsList.innerHTML = results.map(subject => {
                const badgeClass = `badge-${subject.filiere.toLowerCase()}`;
                const highlightedTitle = highlightText(subject.title, searchTerm);
                
                return `
                    <div class="suggestion-item" onclick="selectSuggestion('${subject.id}')">
                        <img src="${subject.imageUrl}" alt="${subject.title}" class="suggestion-icon">
                        <div class="suggestion-info">
                            <div class="suggestion-title">${highlightedTitle}</div>
                            <div class="suggestion-meta">
                                <span class="suggestion-badge ${badgeClass}">${subject.filiere}</span>
                                <span>üìÖ ${subject.year}</span>
                                <span>üë§ ${subject.authorName}</span>
                                <span>üí¨ ${subject.messages?.length || 0}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function highlightText(text, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<span class="suggestion-highlight">$1</span>');
        }

        window.selectSuggestion = function(subjectId) {
            const subject = subjects.find(s => s.id === subjectId);
            if (subject) {
                document.getElementById('searchSuggestions').classList.remove('active');
                openImageFullscreen(subject.imageUrl);
            }
        };

        // Search input event listener
        document.getElementById('searchInput').addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                performSearch(e.target.value);
            }, 300);
        });

        // Close suggestions when clicking outside
        document.addEventListener('click', function(e) {
            const searchContainer = document.querySelector('.search-container');
            if (!searchContainer.contains(e.target)) {
                document.getElementById('searchSuggestions').classList.remove('active');
            }
        });

        // IMAGE FULLSCREEN FUNCTIONS
        window.openImageFullscreen = function(imageUrl) {
            currentImageUrl = imageUrl;
            document.getElementById('fullscreenImage').src = imageUrl;
            document.getElementById('imageFullscreenModal').style.display = 'flex';
        };

        window.closeImageFullscreen = function() {
            document.getElementById('imageFullscreenModal').style.display = 'none';
            currentImageUrl = '';
        };

        window.downloadImage = function() {
            if (!currentImageUrl) return;
            
            const link = document.createElement('a');
            link.href = currentImageUrl;
            link.download = `StudyDrive_${Date.now()}.jpg`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };

        // INTRO SEQUENCE
        setTimeout(() => {
            document.getElementById('introSection').style.transition = 'opacity 1.5s ease, transform 1.5s ease';
            document.getElementById('introSection').style.opacity = '0';
            document.getElementById('introSection').style.transform = 'scale(1.1)';
            setTimeout(() => {
                document.getElementById('introSection').style.display = 'none';
                checkUser();
            }, 1500);
        }, 3000);

        // GENERATE YEARS
        const yearSelect = document.getElementById('subjectYear');
        const currentYear = new Date().getFullYear();
        for (let i = currentYear; i >= currentYear - 10; i--) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            yearSelect.appendChild(option);
        }

        // REGISTRATION
        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const nom = document.getElementById('nom').value.trim();
            const prenom = document.getElementById('prenom').value.trim();
            const filiere = document.getElementById('filiere').value;
            const contact = document.getElementById('contact').value.trim();

            const submitBtn = e.target.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Connexion...';

            try {
                const userId = `user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                userData = {
                    id: userId,
                    nom,
                    prenom,
                    filiere,
                    contact,
                    fullName: `${prenom} ${nom}`,
                    avatar: `${prenom[0].toUpperCase()}${nom[0].toUpperCase()}`,
                    registeredAt: new Date().toISOString()
                };

                sessionStorage.setItem('studydriveUser', JSON.stringify(userData));
                localStorage.setItem('studydriveUser', JSON.stringify(userData));

                await setDoc(doc(db, 'studydrive_users', userData.id), {
                    ...userData,
                    createdAt: serverTimestamp()
                });

                document.getElementById('registrationOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                
                document.getElementById('userName').textContent = userData.fullName;
                document.getElementById('userAvatar').textContent = userData.avatar;
                document.getElementById('userFiliere').textContent = userData.filiere;

                loadSubjects();

            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur lors de l\'inscription');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Acc√©der';
            }
        });

        // CHECK USER
        function checkUser() {
            const sessionData = sessionStorage.getItem('studydriveUser');
            const localData = localStorage.getItem('studydriveUser');
            const dataToUse = sessionData || localData;
            
            if (dataToUse) {
                userData = JSON.parse(dataToUse);
                document.getElementById('registrationOverlay').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userName').textContent = userData.fullName;
                document.getElementById('userAvatar').textContent = userData.avatar;
                document.getElementById('userFiliere').textContent = userData.filiere;
                loadSubjects();
            } else {
                document.getElementById('registrationOverlay').style.display = 'flex';
            }
        }

        // LOAD SUBJECTS
        function loadSubjects() {
            const q = query(collection(db, 'studydrive_subjects'), orderBy('timestamp', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                subjects = [];
                snapshot.forEach((doc) => {
                    subjects.push({ id: doc.id, ...doc.data() });
                });
                renderSubjects();
            });
        }

        // RENDER SUBJECTS
        function renderSubjects() {
            const grid = document.getElementById('subjectsGrid');
            
            const filteredSubjects = currentFilter === 'all' 
                ? subjects 
                : subjects.filter(s => s.filiere === currentFilter);

            if (filteredSubjects.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 80px 20px;">
                        <h3 style="font-family: 'Playfair Display', serif; font-size: 32px; margin-bottom: 15px; color: var(--gold-light);">Collection Vide</h3>
                        <p style="color: var(--gray);">Aucun sujet disponible pour cette s√©lection</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = filteredSubjects.map(subject => {
                const badgeClass = `badge-${subject.filiere.toLowerCase()}`;
                return `
                    <div class="subject-card">
                        <img src="${subject.imageUrl}" alt="${subject.title}" class="subject-image" onclick="openImageFullscreen('${subject.imageUrl}')" style="cursor: zoom-in;">
                        <div class="subject-content">
                            <div class="subject-header">
                                <div class="subject-title">${subject.title}</div>
                                <span class="subject-badge ${badgeClass}">${subject.filiere}</span>
                            </div>
                            <div class="subject-meta">
                                <span>üìÖ ${subject.year}</span>
                                <span>üí¨ ${subject.messages?.length || 0}</span>
                            </div>
                            ${subject.description ? `<p style="color: var(--gray); font-size: 14px; margin-bottom: 15px; line-height: 1.6;">${subject.description}</p>` : ''}
                            <div class="subject-divider"></div>
                            <div class="subject-author">
                                <div class="author-avatar">${subject.authorAvatar}</div>
                                <div style="flex: 1;">
                                    <div class="author-name">${subject.authorName}</div>
                                    <div class="author-time">${formatTime(subject.timestamp)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // FILTERS
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.dataset.filter;
                renderSubjects();
            });
        });

        // PUBLISH MODAL
        window.openPublishModal = function() {
            document.getElementById('publishModal').style.display = 'flex';
        };

        window.closePublishModal = function() {
            document.getElementById('publishModal').style.display = 'none';
            document.getElementById('publishForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
        };

        // IMAGE PREVIEW
        document.getElementById('subjectImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = 
                        `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // UPLOAD TO CLOUDINARY
        async function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', cloudinaryConfig.uploadPreset);
            
            const response = await fetch(
                `https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/image/upload`,
                {
                    method: 'POST',
                    body: formData
                }
            );
            
            const data = await response.json();
            return data.secure_url;
        }

        // SUBMIT FORM
        document.getElementById('publishForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('.submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Publication...';

            try {
                const title = document.getElementById('subjectTitle').value;
                const filiere = document.getElementById('subjectFiliere').value;
                const year = document.getElementById('subjectYear').value;
                const description = document.getElementById('subjectDescription').value;
                const imageFile = document.getElementById('subjectImage').files[0];

                const imageUrl = await uploadToCloudinary(imageFile);

                const subjectData = {
                    title,
                    filiere,
                    year: parseInt(year),
                    description,
                    imageUrl,
                    authorId: userData.id,
                    authorName: userData.fullName,
                    authorAvatar: userData.avatar,
                    authorContact: userData.contact,
                    messages: [],
                    timestamp: serverTimestamp()
                };

                await addDoc(collection(db, 'studydrive_subjects'), subjectData);

                closePublishModal();
                alert('‚úÖ Sujet publi√© avec succ√®s !');

            } catch (error) {
                console.error('Erreur:', error);
                alert('‚ùå Erreur lors de la publication');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Publier';
            }
        });

        // FORMAT TIME
        function formatTime(timestamp) {
            if (!timestamp) return '√Ä l\'instant';
            
            let date;
            if (timestamp.seconds) {
                date = new Date(timestamp.seconds * 1000);
            } else if (typeof timestamp === 'string') {
                date = new Date(timestamp);
            } else {
                return '√Ä l\'instant';
            }

            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return '√Ä l\'instant';
            if (diffMins < 60) return `${diffMins} min`;
            if (diffHours < 24) return `${diffHours}h`;
            if (diffDays < 7) return `${diffDays}j`;
            
            return date.toLocaleDateString('fr-FR', { 
                day: 'numeric', 
                month: 'short'
            });
        }

        // CLOSE MODAL
        document.getElementById('publishModal').addEventListener('click', function(e) {
            if (e.target === this) closePublishModal();
        });

        // CLOSE IMAGE FULLSCREEN ON OUTSIDE CLICK
        document.getElementById('imageFullscreenModal').addEventListener('click', function(e) {
            if (e.target === this) closeImageFullscreen();
        });

        // KEYBOARD SHORTCUTS
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('imageFullscreenModal').style.display === 'flex') {
                    closeImageFullscreen();
                } else if (document.getElementById('publishModal').style.display === 'flex') {
                    closePublishModal();
                }
            }
        });
    </script>
</body>
</html>